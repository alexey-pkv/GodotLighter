# SQLStmt

**Extends:** [RefCounted](https://docs.godotengine.org/en/4.3/classes/class_refcounted.html)

The `SQLStmt` class represents the result of executing an SQL statement. It provides methods to access and manipulate the data returned by the query. This class facilitates both navigation through the result set and extraction of data in various formats.

## Methods

### `is_failed(): bool`
**Description**: Checks if the statement execution failed.

**Return**: `true` if an error occurred during execution, otherwise `false`.

> **Note**: There's an important difference between `is_failed()` and `is_error()`. The `is_failed()` method indicates that the statement object contains an error resulting from a failed initialization or execution, while `is_error()` refers to the specific SQLite result code of the last operation. A statement can be in an error state for a specific step (`is_error() == true`) without the entire statement being considered failed (`is_failed() == false`).

**Example**:
```gdscript
# Example of is_failed() vs is_error() difference
var stmt = sql.execute_stmt("SELECT * FROM non_existent_table")

# The statement failed to execute as the table doesn't exist
print("Statement is_failed(): %s" % stmt.is_failed())  # Will print true
print("Error message: %s" % stmt.get_err().error())    # Will show the SQLite error

# Example of a statement that executes but might have error state during iteration
var valid_stmt = sql.execute_stmt("SELECT * FROM Users")

if not valid_stmt.is_failed():

    # Statement created successfully
    # First row is already loaded if it exists, so check has_row first
    while valid_stmt.has_row():
    
        # Process the current row
        print(valid_stmt.row())
        
        # Advance to the next row
        valid_stmt.step()
        
        # Check if an error occurred during the step operation
        if valid_stmt.is_error():
            print("Step operation resulted in error, code: %d" % valid_stmt.code())
            break
    
    if not valid_stmt.is_error():
        print("Reached end of results successfully")
```

---

### `get_err(): SQLErrorInfo`
**Description**: Returns the error information for a failed statement.

**Return**: An [SQLErrorInfo](SQLErrorInfo.md) object containing error details, or `null` if no error occurred.

---

### `code(): int`
**Description**: Returns the SQLite result code of the last step operation. 

> This is the SQLite specific error code and not the code generated by the SQLighter library. See [SQLite Error Codes](https://www.sqlite.org/rescode.html) for more info.

**Return**: An integer representing the SQLite result code.

---

### `is_done(): bool`
**Description**: Checks if the statement has completed execution and no more rows are available.

**Return**: `true` if the statement has completed execution, otherwise `false`.

---

### `is_ok(): bool`
**Description**: Checks if the last operation was successful. The "last operation" refers to the most recent SQLite operation performed on this statement, which could be the initial execution of the query or a subsequent call to `step()`.

**Return**: `true` if the last operation was successful, otherwise `false`.

---

### `is_error(): bool`
**Description**: Checks if the last operation resulted in an error. The "last operation" refers to the most recent SQLite operation performed on this statement (initial execution or a call to `step()`). This method only reports the status of the specific operation and not the overall statement status, which is reflected by `is_failed()`.

**Return**: `true` if an error occurred during the last operation, otherwise `false`.

---

### `has_row(): bool`
**Description**: Checks if the statement has a row available for reading.

**Return**: `true` if a row is available, otherwise `false`.

---

### `query_string(): String`
**Description**: Returns the SQL query string associated with this statement.

**Return**: The SQL query string.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT * FROM Users WHERE Age > ?", [18])
print("Executed query: %s" % stmt.query_string())
```

---

### `step(): int`
**Description**: Advances the statement to the next row. After calling this method, you should check `is_error()` to determine if the step was successful, and `has_row()` or `is_done()` to determine if there are more rows available. Each call to `step()` updates the status of the statement, which affects the results of `code()`, `is_ok()`, `is_error()`, `has_row()`, and `is_done()`.

**Return**: The SQLite result code of the step operation.

---

### `close(): int`
**Description**: Finalizes the statement and releases resources.

**Return**: The SQLite result code of the close operation.

---



---

### `value(): Variant`
**Description**: Returns the value of the first column in the current row.

**Return**: The value as a `Variant`, or `null` if the column value is NULL.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT COUNT(*) FROM Users")
if not stmt.is_failed():
    var count = stmt.value()
    print("Total users: %d" % count)
```

---

### `column_value(name: String): Variant`

| Parameter | Type   | Description               |
|-----------|--------|---------------------------|
| `name`    | String | The name of the column.   |

**Description**: Returns the value of the specified column in the current row.

**Return**: The value as a `Variant`, or `null` if the column value is NULL.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT Name, Age, Email FROM Users WHERE ID = ?", [1])
if not stmt.is_failed() and stmt.has_row():
    var name = stmt.column_value("Name")
    var email = stmt.column_value("Email")
    print("User %s's email is %s" % [name, email])
```

---

### `column_value_i(at: int): Variant`

| Parameter | Type | Description                    |
|-----------|------|--------------------------------|
| `at`      | int  | The index of the column (0-based). |

**Description**: Returns the value of the column at the specified index in the current row.

**Return**: The value as a `Variant`, or `null` if the column value is NULL.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT Name, Age, Email FROM Users WHERE ID = ?", [1])
if not stmt.is_failed() and stmt.has_row():
    # Get first and third columns by index
    var name = stmt.column_value_i(0)
    var email = stmt.column_value_i(2)
    print("User %s's email is %s" % [name, email])
```

---

### `column_int_i(at: int): int`

| Parameter | Type | Description                    |
|-----------|------|--------------------------------|
| `at`      | int  | The index of the column (0-based). |

**Description**: Returns the integer value of the column at the specified index.

**Return**: The integer value of the column.

---

### `column_bool_i(at: int): bool`

| Parameter | Type | Description                    |
|-----------|------|--------------------------------|
| `at`      | int  | The index of the column (0-based). |

**Description**: Returns the boolean value of the column at the specified index.

**Return**: The boolean value of the column.

---

### `column_double_i(at: int): float`

| Parameter | Type | Description                    |
|-----------|------|--------------------------------|
| `at`      | int  | The index of the column (0-based). |

**Description**: Returns the floating-point value of the column at the specified index.

**Return**: The floating-point value of the column.

---

### `column_string_i(at: int): String`

| Parameter | Type | Description                    |
|-----------|------|--------------------------------|
| `at`      | int  | The index of the column (0-based). |

**Description**: Returns the string value of the column at the specified index.

**Return**: The string value of the column.

---

### `column_is_null_i(at: int): bool`

| Parameter | Type | Description                    |
|-----------|------|--------------------------------|
| `at`      | int  | The index of the column (0-based). |

**Description**: Checks if the value of the column at the specified index is NULL.

**Return**: `true` if the column value is NULL, otherwise `false`.

---

### `column_int(name: String): int`

| Parameter | Type   | Description             |
|-----------|--------|-------------------------|
| `name`    | String | The name of the column. |

**Description**: Returns the integer value of the specified column.

**Return**: The integer value of the column.

---

### `column_bool(name: String): bool`

| Parameter | Type   | Description             |
|-----------|--------|-------------------------|
| `name`    | String | The name of the column. |

**Description**: Returns the boolean value of the specified column.

**Return**: The boolean value of the column.

---

### `column_double(name: String): float`

| Parameter | Type   | Description             |
|-----------|--------|-------------------------|
| `name`    | String | The name of the column. |

**Description**: Returns the floating-point value of the specified column.

**Return**: The floating-point value of the column.

---

### `column_string(name: String): String`

| Parameter | Type   | Description             |
|-----------|--------|-------------------------|
| `name`    | String | The name of the column. |

**Description**: Returns the string value of the specified column.

**Return**: The string value of the column.

---

### `column_is_null(name: String): bool`

| Parameter | Type   | Description             |
|-----------|--------|-------------------------|
| `name`    | String | The name of the column. |

**Description**: Checks if the value of the specified column is NULL.

**Return**: `true` if the column value is NULL, otherwise `false`.

---

### `row_numeric(): Array`
**Description**: Returns the current row as an array of values.

**Return**: An array containing the values of all columns in the current row.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT ID, Name, Age FROM Users WHERE ID = ?", [1])
if not stmt.is_failed() and stmt.has_row():
    var row = stmt.row_numeric()
    print("User ID: %d, Name: %s, Age: %d" % [row[0], row[1], row[2]])
```

---

### `row(): Dictionary`
**Description**: Returns the current row as a dictionary with column names as keys.

**Return**: A dictionary mapping column names to their values.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT Name, Age FROM Users WHERE ID = ?", [1])
if not stmt.is_failed():
    var user = stmt.row()
    print("User: %s, Age: %d" % [user["Name"], user["Age"]])
```

---

### `all_numeric(): Array`
**Description**: Returns all rows as an array of arrays, with a default row limit of 10,000.

**Return**: An array of arrays containing the values of all rows.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT ID, Name FROM Users ORDER BY Name")
if not stmt.is_failed():
    var all_users = stmt.all_numeric()
    for user in all_users:
        print("User ID: %d, Name: %s" % [user[0], user[1]])
```

---

### `all(): Array`
**Description**: Returns all rows as an array of dictionaries, with column names as keys and a default row limit of 10,000.

**Return**: An array of dictionaries representing all rows.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT Name, Age FROM Users")
if not stmt.is_failed():
    var users = stmt.all()
    for user in users:
        print("User: %s, Age: %d" % [user["Name"], user["Age"]])
```

---

### `column_all(): Array`
**Description**: Returns all values from the first column of the result set, with a default row limit of 10,000.

**Return**: An array containing the values from the first column of all rows.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT Name FROM Users")
if not stmt.is_failed():
    var names = stmt.column_all()
    for name in names:
        print("User: %s" % name)
```

---

### `all_numeric_max(failsafeLimit: int): Array`

| Parameter      | Type | Description                                            |
|----------------|------|--------------------------------------------------------|
| `failsafeLimit` | int  | The maximum number of rows to retrieve.               |

**Description**: Returns all rows as an array of arrays, with a specified row limit.

**Return**: An array of arrays containing the values of all rows.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT ID, Name FROM Users ORDER BY Name")
if not stmt.is_failed():
    # Increase the limit to 50,000 rows
    var all_users = stmt.all_numeric_max(50000)
    print("Retrieved %d users" % all_users.size())
```

---

### `all_max(failsafeLimit: int): Array`

| Parameter      | Type | Description                                            |
|----------------|------|--------------------------------------------------------|
| `failsafeLimit` | int  | The maximum number of rows to retrieve.               |

**Description**: Returns all rows as an array of dictionaries, with a specified row limit.

**Return**: An array of dictionaries representing all rows.

---

### `column_all_max(failsafeLimit: int): Array`

| Parameter      | Type | Description                                            |
|----------------|------|--------------------------------------------------------|
| `failsafeLimit` | int  | The maximum number of rows to retrieve.               |

**Description**: Returns all values from the first column of the result set, with a specified row limit.

**Return**: An array containing the values from the first column of all rows.

---

### `column_names(): Array`
**Description**: Returns an array of all column names in the result set.

**Return**: An array of strings containing the column names.

**Example**:
```gdscript
var stmt = sql.execute_stmt("SELECT * FROM Users")
if not stmt.is_failed():
    var columns = stmt.column_names()
    print("Table columns: %s" % columns)
```